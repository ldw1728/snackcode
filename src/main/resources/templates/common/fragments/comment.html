<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="comment-fragment">

    <div class="w-full h-fit">
        <!-- 코멘트 쓰기 영역 -->
        <div name="commentWritePanel" class="relative w-3/4 mx-auto ring-1 ring-gray-300 h-fit focus:ring-inset focus:ring-indigo-600 my-5">
            <textarea name="cntnsArea" rows="5" class="block border-b p-3 w-full mb-1  py-1.5 text-gray-900 placeholder:text-gray-400  sm:text-sm sm:leading-6 focus:ring-0 focus:ring-indigo-100"></textarea>
            <button onclick="commentSave(this)" type="button" class="m-2 rounded-md bg-black px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">Save</button>
        </div>

        <!-- 코멘트 목록 영역 -->
        <div id="commentListPanel" class="relative w-3/4 mx-auto my-5">

            <div id="comment" class="border m-2 p-3 h-fit">
                <div id="commentCntns" class="h-fit">asdasd</div>
                <div id="commentProfile" class="h-fit text-sm text-gray-500 mt-5">
                    <span id="commentName" class="font-semibold mx-4">ldw2730</span>
                    <span id="commentDate" class="italic mx-4">2014-01-01</span>
                    <div class="inline-block mx-4">
                        <button type="button" class=" rounded-md bg-black px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">update</button>
                        <button type="button" class=" rounded-md bg-black px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">delete</button>
                    </div>
                </div>
            </div>


        </div>

    </div>

    <script th:inline="javascript">

        domReady(()=>{

        })

        async function getComments() {
            await axios.get(`/cmmt/${curr_post.id}`)
            .then(res => {
                console.log(res.data)
                createCommentList(res.data);
            })
        }

        //TODO 개발 필요
        async function commentSave(target) {

            alert('준비중입니다..');
            return;

            const cntns = target.parent.querySelector('textarea').value;

            if (!cntns) {
                alert('내용을 입력해 주세요.');
                return;
            }

            await axios.post(`/cmmt/${curr_post.id}`, );
        }

        /**
         * 코멘트 생성
         * @param list
         */
        function createCommentList(list){

            const commentListPanel = document.querySelector('#commentListPanel');
            commentListPanel.innerHTML = '';

            list.forEach((comment, idx) => {
                const commentEl = createComment(comment);
                commentListPanel.insertAdjacentHTML('beforeend', commentEl);
            })
        }

        function createComment(comment) {

            let childrenComment = '';

            if (comment.childComment.length > 0) {
                comment.childComment.forEach((comment, idx) => {
                    childrenComment += createComment(comment);
                })
            }

            const buttons = [[${LoginUser}]]?.id === comment.member.id ?
                `<div class="inline-block mx-4">
                        <button type="button" class=" rounded-md bg-black px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">update</button>
                        <button type="button" class=" rounded-md bg-black px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">delete</button>
                    </div>` : '';

            return `
                <div name="comment" class="border m-2 p-3 h-fit ${comment.prntId ? 'ml-10' : ''}">
                    <div name="commentCntns" class="h-fit">${comment.cntns}</div>
                    <div name="commentProfile" class="h-fit text-sm text-gray-500 mt-5">
                        <span name="commentName" class="font-semibold mx-4">${comment.member.name}</span>
                        <span name="commentDate" class="italic mx-4">${comment.regDt.substring(0, 10)}</span>
                        ${buttons}
                    </div>
                </div>
                ${childrenComment}
            `;
        }

    </script>

</th:block>

